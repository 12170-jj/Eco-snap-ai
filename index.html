<script>
const URL = "https://teachablemachine.withgoogle.com/models/UQwja1MPO/";
let model;
let imageElement;
let score = 0;
let modelReady = false;

const resultBox = document.getElementById("result");

async function loadModel(){
    resultBox.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• AI...";
    model = await tmImage.load(URL+"model.json", URL+"metadata.json");
    modelReady = true;
    resultBox.innerHTML = "‚úÖ ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ";
}
loadModel();

function loadImage(event){
    const img = document.createElement("img");
    img.src = URL.createObjectURL(event.target.files[0]);
    imageElement = img;
    const preview = document.getElementById("preview");
    preview.innerHTML="";
    preview.appendChild(img);
}

async function analyze(){
    if(!modelReady){
        alert("‚è≥ ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà");
        return;
    }
    if(!imageElement){
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô");
        return;
    }

    const prediction = await model.predict(imageElement);
    prediction.sort((a,b)=>b.probability-a.probability);

    resultBox.innerHTML =
        "üóëÔ∏è ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏¢‡∏∞: <b>"+prediction[0].className+"</b><br>" +
        "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: "+(prediction[0].probability*100).toFixed(1)+"%";
}

function finish(){
    score += 10;
    document.querySelector(".score").innerText = "‚≠ê "+score;
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à +10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô");
}
</script>
