<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco Snap AI üåø</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #77dd77; /* Pastel Green */
            --secondary: #ffb7b2; /* Pastel Red/Pink */
            --accent: #fdfd96; /* Pastel Yellow */
            --bg: #f9fffb;
            --text: #4a4a4a;
        }

        body {
            font-family: 'Kanit', sans-serif;
            margin: 0; padding: 0;
            background-color: #e0f2f1;
            display: flex; justify-content: center;
        }

        #app {
            width: 100%; max-width: 450px; min-height: 100vh;
            background: var(--bg); position: relative;
            box-sizing: border-box; display: flex; flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .page { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .hidden { display: none !important; }

        /* Full Screen Role Page */
        #role-page {
            justify-content: center;
            background: linear-gradient(180deg, #f9fffb 0%, #e0f2f1 100%);
        }

        .btn {
            background: var(--primary); color: white; border: none;
            padding: 18px; border-radius: 25px; font-size: 20px;
            font-weight: 600; cursor: pointer; width: 100%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin: 12px 0;
            transition: all 0.2s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-secondary { background: #84b6f4; }
        .btn-back { 
            width: auto; padding: 8px 15px; background: var(--secondary);
            font-size: 14px; position: absolute; top: 15px; left: 15px; border-radius: 15px;
        }

        input, select {
            width: 100%; padding: 15px; margin: 10px 0;
            border-radius: 18px; border: 2px solid #c8e6c9;
            box-sizing: border-box; font-family: 'Kanit'; font-size: 16px;
        }

        .upload-zone {
            width: 100%; height: 280px; border: 4px dashed var(--primary);
            border-radius: 30px; margin: 15px 0; overflow: hidden;
            background: #fff; display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        #webcam, #img-preview { width: 100%; height: 100%; object-fit: cover; }
        
        .result-card {
            background: white; border: 4px solid var(--primary);
            border-radius: 25px; padding: 20px; text-align: center;
            margin: 15px 0; box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .highlight { font-size: 26px; color: #1b4332; font-weight: bold; display: block; }

        .history-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .history-card {
            background: white; border-radius: 20px; overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid #eee;
        }
        .history-card img { width: 100%; height: 110px; object-fit: cover; }
        .history-info { padding: 10px; font-size: 12px; line-height: 1.4; }

        .score-row {
            background: white; padding: 15px; border-radius: 20px;
            margin-bottom: 12px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #f0f0f0;
        }
    </style>
</head>
<body>

<div id="app">
    <div id="role-page" class="page">
        <div style="text-align: center; margin-bottom: 40px;">
            <div style="font-size: 80px;">üåø</div>
            <h1 style="font-size: 32px; margin: 0;">Eco Snap AI</h1>
            <p style="opacity: 0.7;">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ä‡πà‡∏ß‡∏¢‡πÇ‡∏•‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‡πÄ‡∏£‡∏≤</p>
        </div>
        <button class="btn" onclick="showPage('student-login-page')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
        <button class="btn btn-secondary" onclick="showPage('teacher-login-page')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π</button>
    </div>

    <div id="student-login-page" class="page hidden">
        <button class="btn btn-back" onclick="showPage('role-page')">‚¨Ö ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <h2 style="margin-top: 70px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
        <input type="text" id="std-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
        <input type="number" id="std-id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 5 ‡∏´‡∏•‡∏±‡∏Å">
        <select id="std-room">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
            <script>
                const rooms = ["1/1","1/2","1/3","1/4","1/5","2/1","2/2","2/3","2/4","2/5","3/1","3/2","3/3","3/4","4/1","4/2","4/3","5/1","5/2","5/3","5/4","6/1","6/2","6/3"];
                rooms.forEach(r => document.write(`<option value="${r}">${r}</option>`));
            </script>
        </select>
        <button class="btn" id="login-btn" onclick="loginStudent()">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>

    <div id="ai-page" class="page hidden">
        <button class="btn btn-back" onclick="showPage('role-page')">‚¨Ö ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <div style="margin-top: 50px; display: flex; justify-content: space-between; align-items: center; background: white; padding: 10px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <div id="user-info" style="font-size: 14px; font-weight: 600; color: #2d6a4f;"></div>
            <div style="background: var(--accent); padding: 5px 15px; border-radius: 15px; font-weight: bold; border: 2px solid #f0f000;">
                ‚≠ê <span id="user-score">0</span>
            </div>
        </div>

        <div class="upload-zone">
            <video id="webcam" autoplay playsinline muted class="hidden"></video>
            <img id="img-preview" class="hidden">
            <div id="upload-placeholder" style="text-align: center; color: #999;">
                <div style="font-size: 50px;">üì∏</div>
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
            </div>
        </div>

        <div style="display: flex; gap: 10px;">
            <button class="btn btn-secondary" style="font-size: 14px;" onclick="startCamera()">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á</button>
            <button class="btn btn-secondary" style="font-size: 14px;" onclick="document.getElementById('file-input').click()">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</button>
        </div>
        <input type="file" id="file-input" class="hidden" accept="image/*" onchange="handleFileUpload(event)">

        <button class="btn" onclick="predict()" id="predict-btn">üöÄ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏¢‡∏∞</button>
        
        <div id="loading" class="hidden" style="text-align: center; font-weight: bold; color: var(--primary); margin: 10px 0;">‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</div>

        <div id="result-box" class="result-card hidden">
            <span style="font-size: 14px; color: #888;">‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠</span>
            <span id="res-label" class="highlight">---</span>
            <span id="res-conf" style="color: #666; font-size: 14px;">---</span>
            <button class="btn" onclick="saveRecord()" style="margin-top: 15px; background: #2d6a4f;">‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
        </div>

        <h3 style="margin-top: 30px; color: #2d6a4f;">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å</h3>
        <div id="my-history" class="history-grid"></div>
    </div>

    <div id="teacher-login-page" class="page hidden">
        <button class="btn btn-back" onclick="showPage('role-page')">‚¨Ö ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <h2 style="margin-top: 70px;">‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
        <input type="password" id="teacher-pass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (Eco2026)">
        <button class="btn" onclick="loginTeacher()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
    </div>

    <div id="teacher-dashboard" class="page hidden">
        <button class="btn btn-back" onclick="showPage('role-page')">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        <h2 style="margin-top: 70px;">Eco Point üèÜ</h2>
        
        <div style="background: white; padding: 15px; border-radius: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
            <input type="text" id="search-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" oninput="renderLeaderboard()">
            <select id="filter-room" onchange="renderLeaderboard()">
                <option value="">-- ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                <script>rooms.forEach(r => document.write(`<option value="${r}">‡∏´‡πâ‡∏≠‡∏á ${r}</option>`));</script>
            </select>
        </div>

        <div id="leaderboard"></div>
    </div>

    <div id="student-detail-page" class="page hidden">
        <button class="btn btn-back" onclick="showPage('teacher-dashboard')">‚¨Ö ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <h2 id="detail-title" style="margin-top: 70px; color: #2d6a4f;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å</h2>
        <div id="detail-history" class="history-grid"></div>
    </div>
</div>

<script>
    const MODEL_URL = "https://teachablemachine.withgoogle.com/models/UQwja1MPO/";
    let model, webcam, currentUser, allUsers = {};

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å LocalStorage
    function loadGlobalData() {
        const data = localStorage.getItem('eco_snap_data_v2');
        allUsers = data ? JSON.parse(data) : {};
    }
    loadGlobalData();

    async function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(webcam && id !== 'ai-page') { webcam.stop(); }
    }

    // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ---
    function loginStudent() {
        const name = document.getElementById('std-name').value;
        const id = document.getElementById('std-id').value;
        const room = document.getElementById('std-room').value;

        if(!name || id.length !== 5 || !room) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏à‡πâ‡∏≤!");

        if(!allUsers[id]) {
            allUsers[id] = { name, id, room, score: 0, history: [] };
        }
        currentUser = allUsers[id];
        saveData();
        updateStudentUI();
        showPage('ai-page');
    }

    function updateStudentUI() {
        document.getElementById('user-info').innerText = `${currentUser.name} (${currentUser.room})`;
        document.getElementById('user-score').innerText = currentUser.score;
        renderHistoryList('my-history', currentUser.history);
    }

    // --- ‡∏£‡∏∞‡∏ö‡∏ö AI ---
    async function startCamera() {
        document.getElementById('upload-placeholder').classList.add('hidden');
        document.getElementById('img-preview').classList.add('hidden');
        const videoEle = document.getElementById('webcam');
        videoEle.classList.remove('hidden');

        if(!model) model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
        
        webcam = new tmImage.Webcam(300, 300, false); 
        await webcam.setup({ facingMode: "environment" }); 
        await webcam.play();
        
        function loop() {
            webcam.update();
            if(!document.getElementById('ai-page').classList.contains('hidden')) {
                requestAnimationFrame(loop);
            }
        }
        requestAnimationFrame(loop);
    }

    function handleFileUpload(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = document.getElementById('img-preview');
            img.src = event.target.result;
            img.classList.remove('hidden');
            document.getElementById('webcam').classList.add('hidden');
            document.getElementById('upload-placeholder').classList.add('hidden');
            if(webcam) { webcam.stop(); webcam = null; }
        };
        reader.readAsDataURL(file);
    }

    async function predict() {
        if(!model) model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
        
        const imgPreview = document.getElementById('img-preview');
        const videoEle = document.getElementById('webcam');

        let prediction;
        if(!imgPreview.classList.contains('hidden')) {
            prediction = await model.predict(imgPreview);
        } else if(webcam && !videoEle.classList.contains('hidden')) {
            prediction = await model.predict(webcam.canvas);
        } else {
            return alert("‡∏ä‡πà‡∏ß‡∏¢‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏Ç‡∏¢‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ô‡∏∞‡∏Ñ‡∏∞");
        }

        document.getElementById('loading').classList.remove('hidden');
        document.getElementById('result-box').classList.add('hidden');

        const topResult = prediction.sort((a,b) => b.probability - a.probability)[0];
        
        setTimeout(() => {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('res-label').innerText = topResult.className;
            document.getElementById('res-conf').innerText = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: ${(topResult.probability * 100).toFixed(1)}%`;
        }, 1200);
    }

    function saveRecord() {
        const label = document.getElementById('res-label').innerText;
        const conf = document.getElementById('res-conf').innerText;
        const videoEle = document.getElementById('webcam');
        
        let imgSource = "";
        if(!document.getElementById('img-preview').classList.contains('hidden')) {
            imgSource = document.getElementById('img-preview').src;
        } else if(webcam) {
            imgSource = webcam.canvas.toDataURL();
        }

        const newRecord = {
            label, conf, img: imgSource,
            time: new Date().toLocaleString('th-TH')
        };

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å)
        allUsers[currentUser.id].score += 1;
        allUsers[currentUser.id].history.unshift(newRecord);
        
        saveData(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á LocalStorage ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        
        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ
        document.getElementById('result-box').classList.add('hidden');
        document.getElementById('img-preview').classList.add('hidden');
        document.getElementById('upload-placeholder').classList.remove('hidden');
        if(webcam) { webcam.stop(); webcam = null; videoEle.classList.add('hidden'); }
        
        updateStudentUI();
    }

    // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π ---
    function loginTeacher() {
        if(document.getElementById('teacher-pass').value === "Eco2026") {
            showPage('teacher-dashboard');
            renderLeaderboard();
        } else {
            alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö");
        }
    }

    function renderLeaderboard() {
        const search = document.getElementById('search-input').value.toLowerCase();
        const roomFilter = document.getElementById('filter-room').value;
        const container = document.getElementById('leaderboard');
        container.innerHTML = "";

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏°‡∏≤‡∏Å -> ‡∏ô‡πâ‡∏≠‡∏¢
        let players = Object.values(allUsers)
            .filter(u => (u.name.toLowerCase().includes(search) || u.id.includes(search)) && (roomFilter === "" || u.room === roomFilter))
            .sort((a,b) => b.score - a.score);

        if(players.length === 0) {
            container.innerHTML = "<p style='text-align:center; opacity:0.5;'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>";
            return;
        }

        players.forEach(u => {
            const div = document.createElement('div');
            div.className = "score-row";
            div.onclick = () => showStudentDetail(u.id);
            div.innerHTML = `
                <div style="flex: 1;">
                    <strong>${u.name}</strong> <small style="color:#888;">#${u.id}</small><br>
                    <span style="font-size:12px; color:var(--primary); font-weight:bold;">‡∏´‡πâ‡∏≠‡∏á ${u.room}</span>
                </div>
                <div style="font-size:22px; font-weight:bold; color:#2d6a4f;">${u.score} <span style="font-size:12px;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span></div>
            `;
            container.appendChild(div);
        });
    }

    function showStudentDetail(id) {
        const u = allUsers[id];
        document.getElementById('detail-title').innerText = `‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á ${u.name}`;
        renderHistoryList('detail-history', u.history);
        showPage('student-detail-page');
    }

    function renderHistoryList(elementId, historyArray) {
        const container = document.getElementById(elementId);
        if(!historyArray || historyArray.length === 0) {
            container.innerHTML = "<p style='text-align:center; grid-column:1/-1; opacity:0.5; padding:20px;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞</p>";
            return;
        }
        container.innerHTML = historyArray.map(h => `
            <div class="history-card">
                <img src="${h.img || 'https://via.placeholder.com/150'}">
                <div class="history-info">
                    <strong style="color:var(--primary);">${h.label}</strong><br>
                    ${h.conf}<br>
                    <small style="color:#999;">${h.time}</small>
                </div>
            </div>
        `).join('');
    }

    function saveData() {
        localStorage.setItem('eco_snap_data_v2', JSON.stringify(allUsers));
    }
</script>
</body>
</html>
