<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eco Snap AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:sans-serif;
  background:linear-gradient(#b7f5d0,#6fdc9c);
}
.hidden{display:none}
.page{min-height:100vh;padding:20px}
.card{
  background:#fff;
  border-radius:20px;
  padding:20px;
  margin:10px auto;
  max-width:420px;
}
button{
  width:100%;
  padding:15px;
  border:none;
  border-radius:30px;
  font-size:18px;
  margin-top:10px;
}
.green{background:#00c853;color:#fff}
.light{background:#e8fff1}
.gold{background:gold}
input,select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:10px;
}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
img{max-width:100%;border-radius:10px}
</style>
</head>

<body>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó -->
<div id="rolePage" class="page">
  <h1 style="text-align:center">üå± Eco Snap AI</h1>
  <p style="text-align:center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
  <div class="card">
    <button class="green" onclick="chooseRole('student')">üë©‚Äçüéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
    <button class="green" onclick="chooseRole('teacher')">üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π</button>
  </div>
</div>

<!-- ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô -->
<div id="studentLogin" class="page hidden">
  <div class="card">
    <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
    <input id="sName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
    <input id="sId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
    <select id="sRoom">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
      <option>1/1</option><option>1/2</option><option>1/3</option><option>1/4</option><option>1/5</option>
      <option>2/1</option><option>2/2</option><option>2/3</option><option>2/4</option><option>2/5</option>
      <option>3/1</option><option>3/2</option><option>3/3</option><option>3/4</option>
      <option>4/1</option><option>4/2</option><option>4/3</option>
      <option>5/1</option><option>5/2</option><option>5/3</option><option>5/4</option>
      <option>6/1</option><option>6/2</option><option>6/3</option>
    </select>
    <button class="green" onclick="loginStudent()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>
</div>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
<div id="studentPage" class="page hidden">
  <div class="topbar">
    <h3 id="studentTitle"></h3>
    <b>‚≠ê <span id="score">0</span></b>
  </div>

  <div class="card light">
    <input type="file" accept="image/*" id="imageInput">
    <img id="preview" class="hidden">
    <button class="green" onclick="analyze()">üß† ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
    <div id="result"></div>
    <button class="green" onclick="saveResult()">‚úÖ ‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
  </div>

  <div class="card">
    <h4>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h4>
    <div id="history"></div>
  </div>
</div>

<!-- ‡∏Ñ‡∏£‡∏π‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô -->
<div id="teacherLogin" class="page hidden">
  <div class="card">
    <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏π</h3>
    <input id="teacherCode" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏£‡∏π">
    <button class="green" onclick="loginTeacher()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>
</div>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏π -->
<div id="teacherPage" class="page hidden">
  <div class="card">
    <h3>üèÜ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
    <select id="filterRoom" onchange="renderTeacher()">
      <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
      <option>1/1</option><option>1/2</option><option>1/3</option><option>1/4</option><option>1/5</option>
      <option>2/1</option><option>2/2</option><option>2/3</option><option>2/4</option><option>2/5</option>
      <option>3/1</option><option>3/2</option><option>3/3</option><option>3/4</option>
      <option>4/1</option><option>4/2</option><option>4/3</option>
      <option>5/1</option><option>5/2</option><option>5/3</option><option>5/4</option>
      <option>6/1</option><option>6/2</option><option>6/3</option>
    </select>
    <div id="teacherList"></div>
  </div>
</div>

<script>
const URL="https://teachablemachine.withgoogle.com/models/UQwja1MPO/";
let model,currentUser,prediction;

function show(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function chooseRole(r){
  r==="student"?show("studentLogin"):show("teacherLogin");
}

function loginStudent(){
  const name=sName.value,id=sId.value,room=sRoom.value;
  if(!name||!id||!room)return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
  currentUser={name,id,room,score:0,history:[]};
  localStorage.setItem("currentUser",JSON.stringify(currentUser));
  loadStudent();
}

function loadStudent(){
  currentUser=JSON.parse(localStorage.getItem("currentUser"));
  document.getElementById("studentTitle").innerText=currentUser.name+" ("+currentUser.room+")";
  document.getElementById("score").innerText=currentUser.score;
  renderHistory();
  show("studentPage");
}

async function loadModel(){
  if(!model) model=await tmImage.load(URL+"model.json",URL+"metadata.json");
}

async function analyze(){
  const file=imageInput.files[0];
  if(!file)return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô");
  const reader=new FileReader();
  reader.onload=async()=>{
    preview.src=reader.result;
    preview.classList.remove("hidden");
    await loadModel();
    prediction=await model.predict(preview);
    prediction.sort((a,b)=>b.probability-a.probability);
    result.innerHTML=`${prediction[0].className} (${(prediction[0].probability*100).toFixed(1)}%)`;
  };
  reader.readAsDataURL(file);
}

function saveResult(){
  if(!prediction)return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå");
  currentUser.score++;
  currentUser.history.push({
    img:preview.src,
    type:prediction[0].className,
    prob:(prediction[0].probability*100).toFixed(1),
    time:new Date().toLocaleString()
  });
  localStorage.setItem("currentUser",JSON.stringify(currentUser));
  saveGlobal();
  loadStudent();
  imageInput.value="";
  preview.classList.add("hidden");
  result.innerHTML="";
}

function renderHistory(){
  history.innerHTML="";
  currentUser.history.forEach(h=>{
    history.innerHTML+=`<div><img src="${h.img}"><br>${h.type} ${h.prob}%<br>${h.time}</div><hr>`;
  });
}

function saveGlobal(){
  let all=JSON.parse(localStorage.getItem("allUsers")||"{}");
  all[currentUser.id]=currentUser;
  localStorage.setItem("allUsers",JSON.stringify(all));
}

function loginTeacher(){
  if(teacherCode.value!=="Eco2026")return alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");
  renderTeacher();
  show("teacherPage");
}

function renderTeacher(){
  let all=Object.values(JSON.parse(localStorage.getItem("allUsers")||"{}"));
  const r=filterRoom.value;
  if(r) all=all.filter(u=>u.room===r);
  all.sort((a,b)=>b.score-a.score);
  teacherList.innerHTML="";
  all.forEach((u,i)=>{
    teacherList.innerHTML+=`<div class="card ${i<3?'gold':''}">
      ${i+1}. ${u.id} ${u.name} - ${u.score}
    </div>`;
  });
}
</script>
</body>
</html>
