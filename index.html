<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Eco Snap AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>

<style>
body {
  margin: 0;
  font-family: "Prompt", sans-serif;
  background: linear-gradient(135deg,#0f5132,#198754);
  color: white;
  text-align: center;
}
.container {
  max-width: 420px;
  margin: auto;
  padding: 20px;
}
.card {
  background: rgba(0,0,0,0.35);
  border-radius: 20px;
  padding: 20px;
  margin-top: 20px;
}
button {
  background: #00ff9c;
  border: none;
  border-radius: 30px;
  padding: 15px;
  width: 100%;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
}
#camera canvas {
  border-radius: 15px;
  margin-top: 10px;
}
.history-item {
  background: rgba(255,255,255,0.1);
  border-radius: 10px;
  padding: 8px;
  margin-top: 6px;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="container">
  <h1>üå± Eco Snap AI</h1>
  <p>‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Ç‡∏¢‡∏∞ ‚Üí ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‚Üí ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>

  <div class="card">
    <h3>üì∏ ‡∏Å‡∏•‡πâ‡∏≠‡∏á</h3>
    <div id="camera"></div>
    <button onclick="startAI()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏¢‡∏∞</button>
  </div>

  <div class="card">
    <h3>üß† ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h3>
    <div id="result">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</div>
  </div>

  <div class="card">
    <h3>‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°</h3>
    <div id="score">0</div>
  </div>

  <div class="card">
    <h3>üóÇÔ∏è ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h3>
    <div id="history"></div>
  </div>
</div>

<script>
// üî¥ ‡∏ß‡∏≤‡∏á Model URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
const MODEL_URL = "‡∏ß‡∏≤‡∏á_Model_URL_‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ/";

// ===============================
let model, webcam, maxPredictions;
let score = Number(localStorage.getItem("ecoScore")) || 0;
let history = JSON.parse(localStorage.getItem("ecoHistory")) || [];

document.getElementById("score").innerText = score;
renderHistory();

async function startAI() {
  const modelURL = MODEL_URL + "model.json";
  const metadataURL = MODEL_URL + "metadata.json";

  model = await tmImage.load(modelURL, metadataURL);
  maxPredictions = model.getTotalClasses();

  webcam = new tmImage.Webcam(250, 250, true);
  await webcam.setup();
  await webcam.play();

  document.getElementById("camera").innerHTML = "";
  document.getElementById("camera").appendChild(webcam.canvas);

  window.requestAnimationFrame(loop);
}

async function loop() {
  webcam.update();
  await predict();
  window.requestAnimationFrame(loop);
}

async function predict() {
  const predictions = await model.predict(webcam.canvas);
  predictions.sort((a,b)=>b.probability-a.probability);
  const top = predictions[0];

  if (top.probability > 0.85) {
    processResult(top.className);
  }
}

function processResult(type) {
  let bin = "‡∏ñ‡∏±‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ";
  let tip = "‡πÅ‡∏¢‡∏Å‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó";
  let point = 10;

  if (type.toLowerCase().includes("recycle")) {
    bin = "‡∏ñ‡∏±‡∏á‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á";
    tip = "‡∏•‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏¥‡πâ‡∏á";
  }
  if (type.toLowerCase().includes("hazard")) {
    bin = "‡∏ñ‡∏±‡∏á‡∏™‡∏µ‡πÅ‡∏î‡∏á";
    tip = "‡πÅ‡∏¢‡∏Å‡πÉ‡∏™‡πà‡∏ñ‡∏∏‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞";
    point = 15;
  }

  score += point;
  localStorage.setItem("ecoScore", score);

  history.unshift(`‚ôªÔ∏è ${type} ‚Üí ${bin} (+${point})`);
  history = history.slice(0,5);
  localStorage.setItem("ecoHistory", JSON.stringify(history));

  document.getElementById("result").innerHTML = `
    <b>${type}</b><br>
    ‡∏ó‡∏¥‡πâ‡∏á‡∏ó‡∏µ‡πà: ${bin}<br>
    ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${tip}<br>
    ‚≠ê +${point} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
  `;

  document.getElementById("score").innerText = score;
  renderHistory();
}

function renderHistory() {
  document.getElementById("history").innerHTML =
    history.map(h=>`<div class="history-item">${h}</div>`).join("");
}
</script>
</body>
</html>
