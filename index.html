<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eco Snap AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>

<style>
body{margin:0;font-family:sans-serif;background:#e9f7ef}
header{background:#198754;color:#fff;padding:15px;text-align:center}
button{padding:12px 18px;border:none;border-radius:25px;background:#198754;color:#fff;font-size:16px;margin:5px}
input,select{padding:10px;border-radius:10px;border:1px solid #ccc;width:100%;margin:5px 0}
.card{background:#fff;border-radius:20px;padding:15px;margin:15px}
.hidden{display:none}
.score{position:fixed;top:10px;right:15px;background:#ffc107;color:#000;padding:8px 14px;border-radius:20px;font-weight:bold}
.gold{color:#d4af37;font-weight:bold}
img{max-width:100%;border-radius:10px}
</style>
</head>

<body>

<header>
<h1>üå± Eco Snap AI</h1>
<p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
</header>

<div id="role" class="card">
<button onclick="chooseRole('student')">üë©‚Äçüéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
<button onclick="chooseRole('teacher')">üë®‚Äçüè´ ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π</button>
</div>

<!-- LOGIN -->
<div id="loginStudent" class="card hidden">
<h3>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
<input id="sName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
<input id="sId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
<select id="sRoom">
<option>1/1</option><option>1/2</option><option>1/3</option><option>1/4</option><option>1/5</option>
<option>2/1</option><option>2/2</option><option>2/3</option><option>2/4</option><option>2/5</option>
<option>3/1</option><option>3/2</option><option>3/3</option><option>3/4</option>
<option>4/1</option><option>4/2</option><option>4/3</option>
<option>5/1</option><option>5/2</option><option>5/3</option><option>5/4</option>
<option>6/1</option><option>6/2</option><option>6/3</option>
</select>
<button onclick="studentLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<div id="loginTeacher" class="card hidden">
<h3>‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π</h3>
<input id="tPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
<button onclick="teacherLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<!-- STUDENT -->
<div id="studentPage" class="hidden">
<div class="score" id="score">0</div>

<div class="card">
<input type="file" id="imgInput" accept="image/*">
<img id="preview">
<button onclick="analyze()">üß† ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
<div id="result"></div>
<button onclick="saveResult()">‚úÖ ‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
</div>

<div class="card">
<h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h3>
<div id="history"></div>
</div>
</div>

<!-- TEACHER -->
<div id="teacherPage" class="hidden">
<div class="card">
<input id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™" oninput="renderTeacher()">
<select id="roomFilter" onchange="renderTeacher()">
<option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
<option>1/1</option><option>1/2</option><option>1/3</option><option>1/4</option><option>1/5</option>
<option>2/1</option><option>2/2</option><option>2/3</option><option>2/4</option><option>2/5</option>
<option>3/1</option><option>3/2</option><option>3/3</option><option>3/4</option>
<option>4/1</option><option>4/2</option><option>4/3</option>
<option>5/1</option><option>5/2</option><option>5/3</option><option>5/4</option>
<option>6/1</option><option>6/2</option><option>6/3</option>
</select>
</div>

<div class="card" id="teacherList"></div>
</div>

<script>
const URL="https://teachablemachine.withgoogle.com/models/UQwja1MPO/";
let model,currentStudent,currentResult;

function chooseRole(r){
document.getElementById("role").classList.add("hidden");
document.getElementById(r==="student"?"loginStudent":"loginTeacher").classList.remove("hidden");
}

function studentLogin(){
currentStudent={name:sName.value,id:sId.value,room:sRoom.value,score:0,history:[]};
localStorage.setItem("currentStudent",JSON.stringify(currentStudent));
document.getElementById("loginStudent").classList.add("hidden");
document.getElementById("studentPage").classList.remove("hidden");
updateScore();
}

function teacherLogin(){
if(tPass.value!=="Eco2026")return alert("‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
document.getElementById("loginTeacher").classList.add("hidden");
document.getElementById("teacherPage").classList.remove("hidden");
renderTeacher();
}

async function analyze(){
if(!model) model=await tmImage.load(URL+"model.json",URL+"metadata.json");
const img=document.getElementById("preview");
const p=await model.predict(img);
p.sort((a,b)=>b.probability-a.probability);
currentResult=p[0];
result.innerHTML=`${currentResult.className} (${(currentResult.probability*100).toFixed(2)}%)`;
}

function saveResult(){
if(!currentResult)return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå");
const now=new Date().toLocaleString();
currentStudent.history.push({img:preview.src,...currentResult,time:now});
currentStudent.score++;
saveStudent();
resetUpload();
renderHistory();
updateScore();
}

function resetUpload(){
imgInput.value="";
preview.src="";
result.innerHTML="";
currentResult=null;
}

function saveStudent(){
let all=JSON.parse(localStorage.getItem("students")||"[]");
all=all.filter(s=>s.id!==currentStudent.id);
all.push(currentStudent);
localStorage.setItem("students",JSON.stringify(all));
}

function updateScore(){score.innerText=currentStudent.score;}

function renderHistory(){
history.innerHTML="";
currentStudent.history.forEach(h=>{
history.innerHTML+=`<div class="card">
<img src="${h.img}">
<p>${h.className} (${(h.probability*100).toFixed(1)}%)</p>
<small>${h.time}</small>
</div>`;
});
}

function renderTeacher(){
let all=JSON.parse(localStorage.getItem("students")||"[]");
const q=search.value;
const r=roomFilter.value;
all=all.filter(s=>(!q||s.name.includes(q)||s.id.includes(q))&&(!r||s.room===r));
all.sort((a,b)=>b.score-a.score);
teacherList.innerHTML="";
all.forEach((s,i)=>{
teacherList.innerHTML+=`<div class="card ${i<3?"gold":""}">
${i+1}. ${s.name} (${s.score})
</div>`;
});
}
</script>
</body>
</html>
