<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eco Snap AI</title>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: linear-gradient(#0f5132, #198754);
      color: #fff;
      text-align: center;
    }
    h1 {
      margin-top: 20px;
    }
    .card {
      background: #145c3a;
      margin: 20px;
      padding: 20px;
      border-radius: 20px;
    }
    .image-box {
      width: 100%;
      height: 250px;
      background: #0b3d28;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }
    .image-box img {
      max-height: 100%;
      max-width: 100%;
      border-radius: 10px;
    }
    input[type="file"] {
      margin-top: 10px;
    }
    button {
      width: 90%;
      padding: 15px;
      font-size: 18px;
      border: none;
      border-radius: 30px;
      margin-top: 10px;
      cursor: pointer;
    }
    .analyze {
      background: #2dff9c;
      color: #000;
    }
    .done {
      background: #00c853;
      color: #000;
    }
    .result {
      background: #fff;
      color: #000;
      padding: 15px;
      border-radius: 15px;
      margin-top: 15px;
    }
  </style>
</head>

<body>
  <h1>üå± Eco Snap AI</h1>

  <div class="card">
    <div class="image-box">
      <span id="placeholder">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span>
      <img id="preview" style="display:none;">
    </div>
    <input type="file" accept="image/*" id="imageInput">
  </div>

  <div class="card">
    <button class="analyze" onclick="analyze()">üß† ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
    <button class="done">‚úÖ ‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>

    <div id="result" class="result" style="display:none;"></div>
  </div>

<script>
  const URL = "https://teachablemachine.withgoogle.com/models/UQwja1MPO/";
  let model;

  const imageInput = document.getElementById("imageInput");
  const preview = document.getElementById("preview");
  const placeholder = document.getElementById("placeholder");
  const resultBox = document.getElementById("result");

  imageInput.onchange = () => {
    const file = imageInput.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      preview.src = reader.result;
      preview.style.display = "block";
      placeholder.style.display = "none";
    };
    reader.readAsDataURL(file);
  };

  async function loadModel() {
    if (!model) {
      model = await tmImage.load(URL + "model.json", URL + "metadata.json");
    }
  }

  async function analyze() {
    if (!imageInput.files[0]) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô");
      return;
    }

    resultBox.style.display = "block";
    resultBox.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...";

    await loadModel();
    const prediction = await model.predict(preview);

    prediction.sort((a, b) => b.probability - a.probability);
    const top = prediction[0];

    resultBox.innerHTML = `
      <b>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</b><br>
      ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${top.className}<br>
      ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: ${(top.probability * 100).toFixed(2)}%
    `;
  }
</script>

</body>
</html>
