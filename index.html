<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eco Snap AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<style>
body {
  margin: 0;
  font-family: sans-serif;
  background: linear-gradient(#e8f5e9, #c8e6c9);
  color: #1b5e20;
}
h1 {
  text-align: center;
}
.card {
  background: #ffffff;
  margin: 15px;
  padding: 15px;
  border-radius: 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.image-box {
  width: 100%;
  height: 240px;
  background: #e0f2f1;
  border-radius: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.image-box img {
  max-width: 100%;
  max-height: 100%;
  border-radius: 10px;
}
button {
  width: 100%;
  padding: 14px;
  font-size: 18px;
  border: none;
  border-radius: 30px;
  margin-top: 10px;
  cursor: pointer;
}
.analyze { background:#81c784; }
.done { background:#66bb6a; }
.score {
  position: fixed;
  top: 10px;
  right: 10px;
  background: #2e7d32;
  color: #fff;
  padding: 10px 16px;
  border-radius: 20px;
}
.history-card {
  background:#f1f8e9;
  margin-top:10px;
  padding:10px;
  border-radius:12px;
}
</style>
</head>

<body>

<div class="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="score">0</span></div>

<h1>üå± Eco Snap AI</h1>

<div class="card">
  <div class="image-box">
    <span id="placeholder">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span>
    <img id="preview" style="display:none;">
  </div>
  <input type="file" accept="image/*" id="imageInput">
</div>

<div class="card">
  <button class="analyze" onclick="analyze()">üß† ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏¢‡∏∞</button>
  <button class="done" onclick="saveResult()">‚úÖ ‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
  <div id="result" style="margin-top:10px;"></div>
</div>

<div class="card">
  <h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞</h3>
  <div id="history"></div>
</div>

<script>
const URL = "https://teachablemachine.withgoogle.com/models/UQwja1MPO/";

let model = null;
let currentResult = null;
let score = 0;
let historyList = [];

const imageInput = document.getElementById("imageInput");
const preview = document.getElementById("preview");
const placeholder = document.getElementById("placeholder");
const resultBox = document.getElementById("result");
const historyBox = document.getElementById("history");
const scoreBox = document.getElementById("score");

imageInput.onchange = () => {
  const file = imageInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    preview.src = reader.result;
    preview.style.display = "block";
    placeholder.style.display = "none";
    resultBox.innerHTML = "";
    currentResult = null;
  };
  reader.readAsDataURL(file);
};

async function analyze() {
  if (!imageInput.files[0]) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô");
    return;
  }

  resultBox.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...";

  if (!model) {
    model = await tmImage.load(
      URL + "model.json",
      URL + "metadata.json"
    );
  }

  const prediction = await model.predict(preview);
  prediction.sort((a,b)=>b.probability-a.probability);

  currentResult = {
    className: prediction[0].className,
    probability: prediction[0].probability
  };

  resultBox.innerHTML = `
    <b>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</b><br>
    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${currentResult.className}<br>
    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: ${(currentResult.probability*100).toFixed(2)}%
  `;
}

function saveResult() {
  if (!currentResult) {
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏¢‡∏∞");
    return;
  }

  historyList.unshift({
    image: preview.src,
    type: currentResult.className,
    conf: currentResult.probability,
    time: new Date().toLocaleString()
  });

  score++;
  scoreBox.innerText = score;
  renderHistory();
  resetUpload();
}

function renderHistory() {
  historyBox.innerHTML = "";
  historyList.forEach(item=>{
    historyBox.innerHTML += `
      <div class="history-card">
        <img src="${item.image}" style="width:100%;border-radius:8px;">
        <div>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${item.type}</div>
        <div>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: ${(item.conf*100).toFixed(2)}%</div>
        <div>‡πÄ‡∏ß‡∏•‡∏≤: ${item.time}</div>
      </div>
    `;
  });
}

function resetUpload() {
  imageInput.value = "";
  preview.src = "";
  preview.style.display = "none";
  placeholder.style.display = "block";
  resultBox.innerHTML = "";
  currentResult = null;
}
</script>

</body>
</html>
