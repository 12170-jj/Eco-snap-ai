<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eco Snap AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:linear-gradient(#b9fbc0,#7ae582);
}
.container{
  max-width:420px;
  margin:auto;
  padding:15px;
}
.card{
  background:#eafff1;
  border-radius:20px;
  padding:15px;
  margin-bottom:15px;
}
.image-box{
  height:260px;
  background:#d0f4de;
  border-radius:15px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.image-box img{
  max-width:100%;
  max-height:100%;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:30px;
  font-size:18px;
  margin-top:10px;
}
.analyze{background:#2dc653;color:#fff;}
.done{background:#00b4d8;color:#fff;}
.result{
  background:#fff;
  border-radius:15px;
  padding:10px;
  margin-top:10px;
}
.history-item{
  background:#fff;
  border-radius:15px;
  padding:10px;
  margin-top:10px;
}
.score{
  position:fixed;
  top:15px;
  right:20px;
  font-size:22px;
}
</style>
</head>

<body>
<div class="score">‚≠ê <span id="score">0</span></div>

<div class="container">

<h2>üå± Eco Snap AI</h2>

<div class="card">
  <input type="file" id="imageInput" accept="image/*">
  <div class="image-box">
    <span id="placeholder">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span>
    <img id="preview" style="display:none">
  </div>
</div>

<div class="card">
  <button class="analyze" onclick="analyze()">üß† ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
  <div id="result" class="result" style="display:none"></div>
  <button class="done" onclick="confirmSort()">‚úÖ ‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
</div>

<div class="card">
  <h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h3>
  <div id="history"></div>
</div>

</div>

<script>
const URL = "https://teachablemachine.withgoogle.com/models/UQwja1MPO/";
let model;
let currentPrediction = null;
let score = 0;

const imageInput = document.getElementById("imageInput");
const preview = document.getElementById("preview");
const placeholder = document.getElementById("placeholder");
const resultBox = document.getElementById("result");
const historyBox = document.getElementById("history");
const scoreBox = document.getElementById("score");

imageInput.onchange = () => {
  const file = imageInput.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    preview.src = reader.result;
    preview.style.display="block";
    placeholder.style.display="none";
  };
  reader.readAsDataURL(file);
};

async function loadModel(){
  if(!model){
    model = await tmImage.load(URL+"model.json",URL+"metadata.json");
  }
}

async function analyze(){
  if(!imageInput.files.length){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ");
    return;
  }
  resultBox.style.display="block";
  resultBox.innerHTML="‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...";
  await loadModel();
  const prediction = await model.predict(preview);
  prediction.sort((a,b)=>b.probability-a.probability);
  currentPrediction = prediction[0];
  resultBox.innerHTML = `
    <b>${currentPrediction.className}</b><br>
    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à ${(currentPrediction.probability*100).toFixed(1)}%
  `;
}

function confirmSort(){
  if(!currentPrediction){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡πà‡∏≠‡∏ô");
    return;
  }

  score++;
  scoreBox.innerText = score;

  const item = document.createElement("div");
  item.className="history-item";
  item.innerHTML = `
    <img src="${preview.src}" style="width:100%;border-radius:10px"><br>
    <b>${currentPrediction.className}</b><br>
    ${(currentPrediction.probability*100).toFixed(1)}%<br>
    ‚è∞ ${new Date().toLocaleString("th-TH")}
  `;
  historyBox.prepend(item);

  // RESET ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
  imageInput.value="";
  preview.src="";
  preview.style.display="none";
  placeholder.style.display="block";
  resultBox.style.display="none";
  resultBox.innerHTML="";
  currentPrediction = null;
}
</script>

</body>
</html>
