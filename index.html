<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Eco Snap AI</title>
<style>
body {
  font-family: sans-serif;
  background: #eef6ee;
  margin: 0;
  padding: 16px;
}

.header {
  background: #e2f0e2;
  padding: 12px;
  border-radius: 16px;
  margin-bottom: 12px;
}

.header h1 {
  margin: 0;
  color: #2e7d32;
}

.user {
  font-size: 14px;
  color: #444;
}

.score {
  float: right;
  background: #2e7d32;
  color: #fff;
  padding: 6px 12px;
  border-radius: 20px;
}

.card {
  background: #fff;
  border-radius: 16px;
  padding: 12px;
  margin-bottom: 16px;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 20px;
  border: none;
  font-size: 16px;
}

.analyze {
  background: #2e7d32;
  color: white;
}

.done {
  background: #66bb6a;
  color: white;
  margin-top: 8px;
}

.back {
  width: auto;
  padding: 6px 14px;
  font-size: 14px;
  background: #c8e6c9;
  margin-bottom: 10px;
}

.history img {
  width: 100%;
  border-radius: 12px;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <span class="score" id="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</span>
  <h1>üå± Eco Snap AI</h1>
  <div class="user" id="userInfo"></div>
</div>

<button class="back" onclick="goBack()">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</button>

<!-- ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå -->
<div class="card">
  <input type="file" id="imgInput" accept="image/*"><br><br>
  <img id="preview" style="display:none;width:100%;border-radius:12px;">
  <br><br>
  <button class="analyze" onclick="analyze()">üß† ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏¢‡∏∞</button>
  <button class="done" onclick="save()">‚úÖ ‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à</button>

  <h3 id="result"></h3>
</div>

<!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ -->
<div class="card">
  <h2>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞</h2>
  <div id="history"></div>
</div>

<script>
// ---------------- SETUP ----------------
const studentId = "stu001"; // << ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡∏•‡∏≠‡∏î
let students = JSON.parse(localStorage.getItem("students")) || {};
let student = students[studentId] || {
  id: studentId,
  name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡πÄ‡∏≠",
  room: "‡∏õ.6/1",
  score: 0,
  history: []
};
students[studentId] = student;

document.getElementById("userInfo").innerText =
  `${student.name} | ‡∏´‡πâ‡∏≠‡∏á ${student.room}`;
document.getElementById("score").innerText =
  `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${student.score}`;

// ---------------- IMAGE ----------------
imgInput.onchange = () => {
  preview.src = URL.createObjectURL(imgInput.files[0]);
  preview.style.display = "block";
};

// ---------------- ANALYZE ----------------
let current = null;

function analyze() {
  if (!imgInput.files[0]) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ");
    return;
  }

  // ‡∏à‡∏≥‡∏•‡∏≠‡∏á AI
  current = {
    label: Math.random() > 0.5 ? "‡∏Ç‡∏¢‡∏∞‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å" : "‡∏Ç‡∏¢‡∏∞‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ",
    probability: (Math.random() * 40 + 60).toFixed(2),
    img: preview.src,
    time: new Date().toLocaleString()
  };

  result.innerHTML = `
    <strong>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</strong><br>
    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${current.label}<br>
    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: ${current.probability}%
  `;
}

// ---------------- SAVE ----------------
function save() {
  if (!current) {
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå");
    return;
  }

  student.score += 1;
  student.history.unshift(current);

  students[studentId] = student;
  localStorage.setItem("students", JSON.stringify(students));

  score.innerText = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${student.score}`;
  renderHistory();

  current = null;
  result.innerText = "";
  imgInput.value = "";
  preview.style.display = "none";
}

// ---------------- HISTORY ----------------
function renderHistory() {
  history.innerHTML = "";
  student.history.forEach(h => {
    history.innerHTML += `
      <div class="card history">
        <img src="${h.img}">
        <div>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${h.label}</div>
        <div>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: ${h.probability}%</div>
        <div>‡πÄ‡∏ß‡∏•‡∏≤: ${h.time}</div>
      </div>
    `;
  });
}
renderHistory();

// ---------------- BACK ----------------
function goBack() {
  window.location.href = "select-role.html";
}
</script>
</body>
</html>
