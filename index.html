<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Eco Snap AI</title>
<style>
  body { font-family: sans-serif; background:#111; color:#fff; padding:20px }
  input, select, button { margin:5px 0; padding:8px; width:100% }
  .hidden { display:none }
  .card { background:#1e1e1e; padding:15px; margin:10px 0; border-radius:8px }
  button { cursor:pointer }
</style>
</head>

<body>

<h2>üå± Eco Snap AI</h2>

<!-- LOGIN -->
<div id="loginUI" class="card">
  <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠" required>
  <input id="studentId" placeholder="‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" required>

  <select id="room" required>
    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
    <option>1/1</option><option>1/2</option><option>1/3</option>
    <option>2/1</option><option>2/2</option><option>2/3</option>
    <option>3/1</option><option>3/2</option><option>3/3</option>
  </select>

  <input id="teacherCode" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏£‡∏π">
  <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>

  <button id="exportBtn">üì§ Export ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (CSV)</button>
</div>

<!-- STUDENT -->
<div id="studentUI" class="hidden">
  <div class="card">
    <h3>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</h3>
    <input type="file" accept="image/*" onchange="uploadImage()">
  </div>
</div>

<!-- TEACHER -->
<div id="teacherUI" class="hidden">
  <div class="card">
    <h3>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
    <div id="teacherList"></div>
  </div>
</div>

<script>
const TEACHER_PASSWORD = "1234";
let users = [];
let filteredUsers = [];

function login() {
  const name = document.getElementById("name").value;
  const studentId = document.getElementById("studentId").value;
  const room = document.getElementById("room").value;
  const teacherCode = document.getElementById("teacherCode").value;

  if (teacherCode === TEACHER_PASSWORD) {
    document.getElementById("teacherUI").classList.remove("hidden");
  } else {
    document.getElementById("studentUI").classList.remove("hidden");

    users.push({
      name,
      studentId,
      room,
      score: Math.floor(Math.random() * 100)
    });
  }

  document.getElementById("loginUI").classList.add("hidden");
  renderTeacher();
}

function uploadImage() {
  alert("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô");
}

function renderTeacher() {
  filteredUsers = [...users];

  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏Å ‚Üí ‡∏ô‡πâ‡∏≠‡∏¢
  filteredUsers.sort((a, b) => b.score - a.score);

  const list = document.getElementById("teacherList");
  list.innerHTML = "";

  filteredUsers.forEach((u, index) => {
    list.innerHTML += `
      <div class="card">
        ${index + 1}. ${u.name} (${u.room}) ‚Äî ${u.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
      </div>
    `;
  });
}

/* ===== 4.1 ‡∏™‡∏£‡πâ‡∏≤‡∏á CSV ===== */
function buildCSV(users) {
  let csv = "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö,‡∏ä‡∏∑‡πà‡∏≠,‡∏´‡πâ‡∏≠‡∏á,‡πÄ‡∏•‡∏Ç‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô,‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô\n";
  users.forEach((u, i) => {
    csv += `${i+1},${u.name},${u.room},${u.studentId},${u.score}\n`;
  });
  return csv;
}

/* ===== 4.2 ‡∏õ‡∏∏‡πà‡∏° Export CSV ===== */
document.getElementById("exportBtn").addEventListener("click", () => {
  if (!filteredUsers || filteredUsers.length === 0) {
    alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ export");
    return;
  }

  const csv = buildCSV(filteredUsers);
  const blob = new Blob(["\ufeff" + csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô.csv";
  a.click();

  URL.revokeObjectURL(url);
});
</script>

</body>
</html>
